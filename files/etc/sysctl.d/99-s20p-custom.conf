##### 网关：MT7986a/2GB + PPE/HNAT + WiFi + PPPoE + TPROXY/WG #####

# --- conntrack：66636*2 ---
net.netfilter.nf_conntrack_max = 131072
net.netfilter.nf_conntrack_buckets = 32768

# --- 抗突发：网卡/软中断 backlog ---
net.core.netdev_max_backlog = 8192
net.core.somaxconn = 8192
net.ipv4.tcp_max_syn_backlog = 4096

# --- socket 缓冲：给 WG/UDP/QUIC 留空间 ---
net.core.rmem_default = 524288
net.core.wmem_default = 524288
net.core.rmem_max = 4194304
net.core.wmem_max = 4194304

# --- TIME_WAIT 与端口资源：家庭多终端 + 代理短连接更稳 ---
net.ipv4.tcp_tw_reuse = 2
net.ipv4.tcp_max_tw_buckets = 131072
net.ipv4.tcp_max_orphans = 16384
net.ipv4.ip_local_port_range = 1024 65535

# --- 可选 ---
net.ipv4.tcp_congestion_control = bbr
net.core.default_qdisc = fq_codel
net.ipv4.tcp_fastopen = 3

# --- VM：避免 swap 抖动 ---
vm.swappiness = 10
vm.min_free_kbytes = 65536

# --- IPv6 RA：全局关闭，接口交给 netifd 控制（PPPoE 场景推荐） ---
# net.ipv6.conf.all.accept_ra = 0
# net.ipv6.conf.default.accept_ra = 0